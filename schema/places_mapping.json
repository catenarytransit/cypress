{
  "settings": {
    "number_of_shards": 1,
    "number_of_replicas": 0,
    "index": {
      "codec": "best_compression",
      "refresh_interval": "60s",
      "mapping": {
        "total_fields": {
          "limit": 20000
        }
      }
    },
    "analysis": {
      "tokenizer": {
        "peliasTokenizer": {
          "type": "pattern",
          "pattern": "[\\s,/\\\\-]+"
        }
      },
      "char_filter": {
        "alphanumeric": {
          "type": "pattern_replace",
          "pattern": "[^a-zA-Z0-9]",
          "replacement": ""
        },
        "numeric": {
          "type": "pattern_replace",
          "pattern": "[^0-9]",
          "replacement": " "
        },
        "nfkc_normalizer": {
          "type": "icu_normalizer",
          "name": "nfkc",
          "mode": "compose"
        }
      },
      "filter": {
        "peliasAsciiFolding": {
          "type": "asciifolding",
          "preserve_original": true
        },
        "peliasSynonymFilter": {
          "type": "synonym",
          "synonyms": [
            "street,st,str",
            "avenue,ave,av",
            "road,rd",
            "boulevard,blvd,bd",
            "place,pl",
            "square,sq",
            "drive,dr",
            "lane,ln",
            "court,ct"
          ]
        },
        "peliasOneEdgeGramFilter": {
          "type": "edge_ngram",
          "min_gram": 1,
          "max_gram": 24
        },
        "notnull": {
          "type": "length",
          "min": 1
        },
        "unique_only_same_position": {
          "type": "unique",
          "only_on_same_position": true
        },
        "remove_duplicate_spaces": {
          "type": "pattern_replace",
          "pattern": " +",
          "replacement": " "
        },
        "remove_ordinals": {
          "type": "pattern_replace",
          "pattern": "(?i)((^| )((1)st?|(2)nd?|(3)rd?|([4-9])th?)|(([0-9]*)(1[0-9])th?)|(([0-9]*[02-9])((1)st?|(2)nd?|(3)rd?|([04-9])th?))($| ))",
          "replacement": "$2$4$5$6$7$9$10$12$14$15$16$17$18"
        }
      },
      "analyzer": {
        "peliasIndex": {
          "type": "custom",
          "tokenizer": "peliasTokenizer",
          "char_filter": [
            "nfkc_normalizer"
          ],
          "filter": [
            "lowercase",
            "trim",
            "peliasAsciiFolding",
            "unique_only_same_position",
            "notnull"
          ]
        },
        "peliasIndexOneEdgeGram": {
          "type": "custom",
          "tokenizer": "peliasTokenizer",
          "char_filter": [
            "nfkc_normalizer"
          ],
          "filter": [
            "lowercase",
            "trim",
            "peliasAsciiFolding",
            "peliasOneEdgeGramFilter",
            "unique_only_same_position",
            "notnull"
          ]
        },
        "peliasQuery": {
          "type": "custom",
          "tokenizer": "peliasTokenizer",
          "char_filter": [
            "nfkc_normalizer"
          ],
          "filter": [
            "lowercase",
            "trim",
            "peliasAsciiFolding",
            "peliasSynonymFilter",
            "unique_only_same_position",
            "notnull"
          ]
        },
        "peliasAdmin": {
          "type": "custom",
          "tokenizer": "peliasTokenizer",
          "char_filter": [
            "nfkc_normalizer"
          ],
          "filter": [
            "lowercase",
            "trim",
            "peliasAsciiFolding",
            "unique_only_same_position",
            "notnull"
          ]
        },
        "peliasStreet": {
          "type": "custom",
          "tokenizer": "peliasTokenizer",
          "char_filter": [
            "nfkc_normalizer"
          ],
          "filter": [
            "lowercase",
            "trim",
            "remove_duplicate_spaces",
            "peliasSynonymFilter",
            "peliasAsciiFolding",
            "remove_ordinals",
            "unique_only_same_position",
            "notnull"
          ]
        },
        "peliasZip": {
          "type": "custom",
          "tokenizer": "keyword",
          "char_filter": [
            "alphanumeric",
            "nfkc_normalizer"
          ],
          "filter": [
            "lowercase",
            "trim",
            "peliasAsciiFolding",
            "unique_only_same_position",
            "notnull"
          ]
        }
      }
    }
  },
  "mappings": {
    "_source": {
      "enabled": false
    },
    "dynamic": "true",
    "dynamic_templates": [],
    "properties": {
      "source_id": {
        "type": "keyword",
        "doc_values": true,
        "norms": false
      },
      "source_file": {
        "type": "keyword",
        "doc_values": true,
        "norms": false
      },
      "import_timestamp": {
        "type": "date",
        "doc_values": true
      },
      "osm_type": {
        "type": "keyword"
      },
      "osm_id": {
        "type": "long",
        "doc_values": true
      },
      "wikidata_id": {
        "type": "keyword",
        "doc_values": true,
        "norms": false
      },
      "importance": {
        "type": "rank_feature"
      },
      "layer": {
        "type": "keyword"
      },
      "categories": {
        "type": "keyword"
      },
      "name_all": {
        "type": "text",
        "analyzer": "peliasIndex",
        "search_analyzer": "peliasQuery",
        "fields": {
          "autocomplete": {
            "type": "text",
            "analyzer": "peliasIndexOneEdgeGram",
            "search_analyzer": "peliasQuery"
          }
        }
      },
      "name": {
        "type": "object",
        "enabled": false
      },
      "phrase": {
        "type": "text",
        "analyzer": "peliasIndex",
        "search_analyzer": "peliasQuery"
      },
      "address": {
        "type": "object",
        "properties": {
          "housenumber": {
            "type": "keyword"
          },
          "street": {
            "type": "text",
            "analyzer": "peliasStreet",
            "search_analyzer": "peliasQuery"
          },
          "postcode": {
            "type": "text",
            "analyzer": "peliasZip",
            "search_analyzer": "peliasZip"
          },
          "city": {
            "type": "text",
            "analyzer": "peliasAdmin",
            "search_analyzer": "peliasQuery"
          }
        }
      },
      "center_point": {
        "type": "geo_point"
      },
      "bbox": {
        "type": "geo_shape"
      },
      "parent": {
        "type": "object",
        "properties": {
          "country": {
            "type": "object",
            "properties": {
              "name": {
                "type": "text",
                "analyzer": "peliasAdmin",
                "search_analyzer": "peliasQuery"
              },
              "abbr": {
                "type": "keyword"
              },
              "id": {
                "type": "long"
              }
            }
          },
          "macro_region": {
            "type": "object",
            "properties": {
              "name": {
                "type": "text",
                "analyzer": "peliasAdmin",
                "search_analyzer": "peliasQuery"
              },
              "abbr": {
                "type": "keyword"
              },
              "id": {
                "type": "long"
              }
            }
          },
          "region": {
            "type": "object",
            "properties": {
              "name": {
                "type": "text",
                "analyzer": "peliasAdmin",
                "search_analyzer": "peliasQuery"
              },
              "abbr": {
                "type": "keyword"
              },
              "id": {
                "type": "long"
              }
            }
          },
          "macro_county": {
            "type": "object",
            "properties": {
              "name": {
                "type": "text",
                "analyzer": "peliasAdmin",
                "search_analyzer": "peliasQuery"
              },
              "abbr": {
                "type": "keyword"
              },
              "id": {
                "type": "long"
              }
            }
          },
          "county": {
            "type": "object",
            "properties": {
              "name": {
                "type": "text",
                "analyzer": "peliasAdmin",
                "search_analyzer": "peliasQuery"
              },
              "abbr": {
                "type": "keyword"
              },
              "id": {
                "type": "long"
              }
            }
          },
          "local_admin": {
            "type": "object",
            "properties": {
              "name": {
                "type": "text",
                "analyzer": "peliasAdmin",
                "search_analyzer": "peliasQuery"
              },
              "abbr": {
                "type": "keyword"
              },
              "id": {
                "type": "long"
              }
            }
          },
          "locality": {
            "type": "object",
            "properties": {
              "name": {
                "type": "text",
                "analyzer": "peliasAdmin",
                "search_analyzer": "peliasQuery"
              },
              "abbr": {
                "type": "keyword"
              },
              "id": {
                "type": "long"
              }
            }
          },
          "borough": {
            "type": "object",
            "properties": {
              "name": {
                "type": "text",
                "analyzer": "peliasAdmin",
                "search_analyzer": "peliasQuery"
              },
              "abbr": {
                "type": "keyword"
              },
              "id": {
                "type": "long"
              }
            }
          },
          "neighbourhood": {
            "type": "object",
            "properties": {
              "name": {
                "type": "text",
                "analyzer": "peliasAdmin",
                "search_analyzer": "peliasQuery"
              },
              "abbr": {
                "type": "keyword"
              },
              "id": {
                "type": "long"
              }
            }
          }
        }
      }
    }
  }
}